{
    "queryDefinitions": [
        {
            "queryDefinitionId": "fac42ce8-37ba-4455-b21e-7da86283336e",
            "name": "betmaker/Betmaker Error logs count per hour",
            "queryString": "filter @logStream = \"laravel-log\" \n| filter @message like /production.ERROR/\n#| stats count(*) as errorsCount by bin(1h) as hour\n#| sort hour desc",
            "lastModified": 1738446237416,
            "logGroupNames": [
                "betmaker"
            ]
        },
        {
            "queryDefinitionId": "f714cf03-df78-4c88-a41d-cbaa65d6d7ad",
            "name": "betmaker/executionTime > 5000 by context.id",
            "queryString": "filter @logStream = 'json-debugging-log'\n | fields @timestamp, @message\n | filter context.type = 'betzone'\n | stats sum(context.executionTime) as elapsed_sum, dateceil(earliest(@timestamp), 1ms), dateceil(latest(@timestamp), 1ms) by context.id\n| filter  elapsed_sum > 5\n",
            "lastModified": 1692347858505,
            "logGroupNames": [
                "betmaker"
            ]
        },
        {
            "queryDefinitionId": "f6daa9ea-f4d5-43e0-96e4-04700f9170b4",
            "name": "betmaker/SOPORTE-21469",
            "queryString": "fields @timestamp, @message, @logStream, @log\n| filter @message like /select/\n| sort @timestamp desc",
            "lastModified": 1702454178440,
            "logGroupNames": [
                "betmaker"
            ]
        },
        {
            "queryDefinitionId": "eceffa79-28b7-4280-b729-5a8a198a8ac8",
            "name": "slow queries analisys/query_censite",
            "queryString": "fields @timestamp, @message, @logStream, @log\n| parse @message \"# Query_time: * \" as timing\n| parse @message \" Lock_time: * \" as locktiming\n#| filter @logStream = 'playlogiq-instance'\n| filter @message not like 'DBeaver' \nand @message not like 'select * from payments ignore index'\nand @message not like \"select * from `payments` where `type` = 'payout' and `transaction_id`\"\nand @message not like \"update `casino_settings` set `value` = 1, `casino_settings`.`updated_at` =\"\nand @message not like \"select sum(`amount`) as aggregate from `payments` where (`brand_id\"\nand @message not like \"select `currency_code`, `type`, sum(amount) as total_amount from `payments` where `created_at` between\"\nand @message not like \"select SUM(CASE WHEN type in ('add', 'add_bonus', 'add_bonus_cashback') THEN amount ELSE 0 END) as total_in, SUM(CASE WHEN type in\"\nand @message not like \"update `casino_sessions` set `provider_token` =\"\nand @message not like \"insert into `casino_sessions` (`userid`, `entity_id`, `casino_token`, `session_id`, `game_id`, `game_external_id`, `integration_id`, `start_balance`, `status`, `client_ip`, `updateTime`, `addedTime`) values\"\nand @message not like \"update `casino_sessions` set `status` = \"\nand @message not like \"update `casino_sessions` set `casino_sessions`.`updateTime`\"\nand @message not like \"select * from `casino_sessions` where `userid` = \"\nand @message not like \"SELECT players.*, u_parent.username as parent_username, proxies.ip as proxy_ip,  proxies.port as proxy_port, proxies.is_active as proxy_active\"\nand @message not like \"update `users` set `balance` = balance\"\nand @message not like \"select count(*) as aggregate from `bonus_payments` inner join `bonuses` on `bonuses`.`id` = `bonus_payments`.`bonus_id` inner join `users` on `users`.`id` = `bonus_paymen\"\nand @message not like \"select count(users.id) AS total_count from `users` where `user_level` = \"\nand @message not like \"select SUM(CASE WHEN provider_id NOT IN \"\nand @message not like \"select `id`, `balance`, `balance_withdrawable`, `casino_balance`, `casino_balance_withdrawable` from `users` where `skin_id` =\"\nand @message not like \"select business_report.provider_id as id,\"\nand @message not like \"select users.*,  u_parent.username as parent_username, skins.name as skin_name, (select COALESCE\"\nand @message not like \"select SUM(amount) as total from `ordini` where `userid` = \"\nand @message not like \"select count(*) as aggregate from `sport_jackpot_tickets`\"\nand @message not like \"select business_report.currency as currency, SUM(bonus_bet_closed) as bonus_bet_closed,\"\nand @message not like \"select * from `users` where `users`.`parent_id` =\"\nand @message not like \"select COALESCE(SUM(deposited), 0) as total_deposited, COALESCE(SUM(withdrawn), 0) as total_withdrawn from `transactions_reports` inner join `users` on `users`.`id` = `transactions_reports`.`user_id` where `from` between\"\nand timing > 0\nand @message not like \"select `id`, `balance`, `balance_withdrawable`, `casino_balance`, `casino_balance_withdrawable`, `cash_block`, `parent_id`, `user_path`, `user_level`, `skin_id` from `users` where `id` \"\nand @message not like \"select * from `transactions_reports` where (`user_id` =\"\nand @message not like \"select transactions.id,\n        transactions.payeer_id,\n        transactions.description,\"\nand @message not like \"select business_report_hour.currency as currency,\n            sum(bet) as bet,\n            sum(bet_closed) as bet_closed,\n            sum(bonus_bet_closed) as bonus_bet_closed,\n            sum(win) as win,\"\nand @message not like \"select `payments`.`id`, COALESCE(brands.name\"\nand @message not like \"select count(*) as aggregate from `payments` where (`user_origin_id` = \"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n| sort locktiming desc\n| limit 10000",
            "lastModified": 1733938045134,
            "logGroupNames": [
                "/aws/rds/cluster/backoffice-pro-cluster/slowquery",
                "/aws/rds/cluster/casino-backoffice-bbdd/slowquery",
                "/aws/rds/cluster/playlogiq-cluster/slowquery"
            ]
        },
        {
            "queryDefinitionId": "c722de6b-d41b-4fcc-a14c-730b4b17342d",
            "name": "betmaker/changebalance - timeTaken > 500 - Group By Request And LocalIP",
            "queryString": "filter @logStream = 'apache2-access'\n | fields @timestamp,  @message\n | filter request like /.*integrations\\/.*\\/changebalance/\n | filter timeTaken > 5000\n | stat earliest(time) as FromDate, latest(time) as ToDate, count(*) as Count, avg(timeTaken) as AVG_Time, max(timeTaken) as MAX_Time by localIP, request, status\n | display FromDate, ToDate, localIP, request, status, Count, AVG_Time, MAX_Time",
            "lastModified": 1692187245232,
            "logGroupNames": [
                "betmaker-apache"
            ]
        },
        {
            "queryDefinitionId": "b0d06f1d-8d88-4978-acb5-e03c5b39dd0e",
            "name": "count by type",
            "queryString": "fields @timestamp, @message\n| filter @logStream = 'playlogiq-instance'\n| stats\n  sum(if(@message like 'select `id`, `balance`, `balance_withdrawable`, `casino_balance`, `casino_balance_withdrawable`, `cash_block`, `parent_id`, `user_path`, `user_level`, `skin_id` from `users`', 1, 0)) as Select_Users,\n  sum(if(@message like 'update `users` set `balance` = balance-', 1, 0)) as Update_Users_Balance_Subtract,\n  sum(if(@message like 'update `users` set `balance` = balance+', 1, 0)) as Update_Users_Balance_Add,\n  sum(if(@message like \"select SUM(CASE WHEN type in ('add', 'add_bonus', 'add_bonus_cashback') THEN amount ELSE 0 END) as total_in, SUM(CASE WHEN type in ('out', 'out_bonus', 'out_bonus_cashback')\", 1, 0)) as Select_Sum_Case_When_Type,\n  sum(if(@message like \"update `the_sports_feeds` set `event_start` =\", 1, 0)) as Update_Sports_Feeds_Event_Start,\n  sum(if(@message like \"update `users` set `last_activity` = '\", 1, 0)) as Update_Users_Last_Activity,\n  sum(if(@message like \"select SUM(CASE WHEN provider_id NOT IN\", 1, 0)) as Select_Sum_Provider_ID_Not_In,\n  sum(if(@message like \"select * from `users` where `skin_id` = \", 1, 0)) as Select_Users_by_Skin_ID,\n  sum(if(@message like \"select bonus_payments.*, bonuses.name as bonus_name, skins.name as skin_name, users.username as user_name from `bonus_payments` inner join `bonuses`\", 1, 0)) as Select_Bonus_Payments,\n  sum(if(@message like \"select count(*) as aggregate from `sport_jackpot_tickets` where `sport_jackpot_tickets`.`sport_jackpots_id\", 1, 0)) as Count_Sport_Jackpot_Tickets,\n  sum(if(@message like \"select SUM(business_report.bet) as totBet, SUM(business_report.win) as totWin, SUM(business_report.bonus_bet) as bonus_\", 1, 0)) as Select_Sum_Business_Report,\n  sum(if(@message like \"select * from `users` where `id` =\", 1, 0)) as Select_User_by_ID,\n  sum(if(@message like \"select count(users.id) AS total_count from `users` where `user_level` \", 1, 0)) as Count_Users_by_Level,\n  sum(if(@message like \"select count(*) as aggregate from `bonus_payments` inner join `bonuses` on `bonuses`.`id` = `bonus_payments`\", 1, 0)) as Count_Bonus_Payments,\n  sum(if(@message like \"update `users` set `sport_token` = \", 1, 0)) as Update_Users_Sport_Token,\n  sum(if(@message like \"select count(*) as aggregate from `commission_cashback_payment` inner join `users`\", 1, 0)) as Count_Commission_Cashback_Payment,\n  sum(if(@message like \"select ordini.id, users.affiliate_id, ordini.payment_status, ordini.promocode, ordini.amount, ordini.skin_id\", 1, 0)) as Select_Orders_with_Affiliates,\n  sum(if(@message like \"update `users` set `last_login` =\", 1, 0)) as Update_Users_Last_Login,\n  sum(if(@message like \"select * from `logiq_feed_matches` where (CONCAT(home_name\", 1, 0)) as Select_Logiq_Feed_Matches,\n  sum(if(@message like \"select * from `users` where `users`.`parent_id` = \", 1, 0)) as Select_Users_by_Parent_ID,\n  sum(if(@message like \"select count(*) as aggregate from `commission_cashback_promotions`\", 1, 0)) as Count_Commission_Cashback_Promotions,\n  sum(if(@message like \"select SUM(business_report.bet) as totBet, SUM(business_report.win) as totWin, business_report.currency as currency,\", 1, 0)) as Select_Sum_Business_Report_with_Currency,\n  sum(if(@message like \"select CONCAT(SUBSTRING(users.mobile_prefix, 2), users.mobile) as msisdn\", 1, 0)) as Select_Concat_User_mobilePrefix,\n  sum(if(@message like \"select `sport_jackpots`.*, (select count(*) from `sport_jackpot_tickets`\", 1, 0)) as Select_Sport_Jeckpots,\n  sum(if(@message like \"select count(*) as aggregate from `sport_jackpot_tickets` left join `users` on `sport_jackpot_tickets`.`user_id`\", 1, 0)) as count_aggregate_sprot_jackpot_tickets,\n  sum(if(@message like \"insert into `ordini` (`amount`, `currency`, `userid`, `payment_method`, `skin_id`, `token`,\", 1, 0)) as InsertOrdini,\n  sum(if(@message like \"insert into `markets` (`active`, `category_name`\", 1, 0)) as Insert_into_Markets,\n  sum(if(@message like \"on duplicate key update `odd` = values(`odd`)\", 1, 0)) as Update_on_Duplicate_Key,\n  sum(if(@message like 'DBeaver', 1, 0)) as DBeaver_Queries",
            "lastModified": 1732883597825,
            "logGroupNames": [
                "/aws/rds/cluster/backoffice-pro-cluster/slowquery",
                "/aws/rds/cluster/casino-backoffice-bbdd/slowquery",
                "/aws/rds/cluster/playlogiq-cluster/slowquery"
            ]
        },
        {
            "queryDefinitionId": "ac8bbaf6-15d4-4291-bd65-8d3a3f4f3293",
            "name": "betmaker/PayCommissionCashbacks Execution Time",
            "queryString": "filter @message like /PayCommissionCashbacks /\n| parse @message /PayCommissionCashbacks (?<event>[A-Z]+)/\n| stats min(@timestamp) as startTime, max(@timestamp) as endTime by bin(1d) as day\n| display day, floor((endTime - startTime) / 60000) as jobExecTimeInMinutes\n| sort day desc",
            "lastModified": 1732616744729,
            "logGroupNames": [
                "betmaker"
            ]
        },
        {
            "queryDefinitionId": "a4d00046-7db3-41ad-bb56-57a428dd4c4a",
            "name": "deadlockstats/deadlock1",
            "queryString": "fields @timestamp, @message, @logStream\n| filter @message like 'Transactions deadlock detected' or @message like '(1)' or @message like '(2)' or @message like 'Transactions deadlock detected' or @message like 'WE ROLL BACK TRANSACTION' \n| sort @timestamp",
            "lastModified": 1732724730905,
            "logGroupNames": [
                "/aws/rds/cluster/backoffice-pro-cluster/error",
                "/aws/rds/cluster/casino-backoffice-bbdd/error",
                "/aws/rds/cluster/playlogiq-cluster/error",
                "/aws/rds/instance/casino-backoffice-instance-1/error",
                "/aws/rds/instance/playlogiq-instance-1/error"
            ]
        },
        {
            "queryDefinitionId": "99ede633-60ef-47ae-8c6e-0910e4d32f80",
            "name": "casino/status=5XX and timetaken>5000",
            "queryString": "filter @logStream = 'apache2-access'\n | fields @timestamp, @message\n | filter timeTaken > 5000 and status like /5../",
            "lastModified": 1692346550974,
            "logGroupNames": [
                "casino-lb"
            ]
        },
        {
            "queryDefinitionId": "99dec6f3-d6ab-44ab-9d95-a655321bfa7d",
            "name": "casino/Casino Error logs count per hour",
            "queryString": "fields @timestamp, @message, @logStream, @log\n| filter @message like /local.ERROR/\n| stats count(*) as errorsCount by bin(1h) as hour\n| sort hour desc",
            "lastModified": 1733132850137,
            "logGroupNames": [
                "casino"
            ]
        },
        {
            "queryDefinitionId": "975c861d-7965-418b-9573-e46b18fd11ff",
            "name": "betmaker/changebalance - any skin - timeTaken>5000",
            "queryString": "filter @logStream = 'json-debugging-log'\n | fields @timestamp, @message\n | filter context.type = 'betzone'\n | stats sum(context.executionTime) as elapsed_sum, dateceil(earliest(@timestamp), 1ms), dateceil(latest(@timestamp), 1ms) by context.id\n| filter  elapsed_sum > 5\n",
            "lastModified": 1692347818055,
            "logGroupNames": [
                "betmaker"
            ]
        },
        {
            "queryDefinitionId": "90d98ab2-c90b-4c34-9b6b-18210204856d",
            "name": "slow queries analisys/slow query aggregations by day",
            "queryString": "fields @timestamp, @message\n| filter @logStream = 'playlogiq-instance'\n| stats\n  sum(if(@message like 'select `id`, `balance`, `balance_withdrawable`, `casino_balance`, `casino_balance_withdrawable`, `cash_block`, `parent_id`, `user_path`, `user_level`, `skin_id` from `users`', 1, 0)) as BM16,\n  sum(if(@message like 'update `users` set `balance` = balance-', 1, 0)) as BM14,\n  sum(if(@message like 'update `users` set `balance` = balance+', 1, 0)) as BM14_2,\n  sum(if(@message like \"select SUM(CASE WHEN type in ('add', 'add_bonus', 'add_bonus_cashback') THEN amount ELSE 0 END) as total_in, SUM(CASE WHEN type in ('out', 'out_bonus', 'out_bonus_cashback')\", 1, 0)) as Select_Sum_Case_When_Type,\n  sum(if(@message like \"update `the_sports_feeds` set `event_start` =\", 1, 0)) as Update_Sports_Feeds_Event_Start,\n  sum(if(@message like \"update `users` set `last_activity` = '\", 1, 0)) as Update_Users_Last_Activity,\n  sum(if(@message like \"select SUM(CASE WHEN provider_id NOT IN\", 1, 0)) as Select_Sum_Provider_ID_Not_In,\n  sum(if(@message like \"select * from `users` where `skin_id` = \", 1, 0)) as Select_Users_by_Skin_ID,\n  sum(if(@message like \"select bonus_payments.*, bonuses.name as bonus_name, skins.name as skin_name, users.username as user_name from `bonus_payments` inner join `bonuses`\", 1, 0)) as Select_Bonus_Payments,\n  sum(if(@message like \"select count(*) as aggregate from `sport_jackpot_tickets` where `sport_jackpot_tickets`.`sport_jackpots_id\", 1, 0)) as Count_Sport_Jackpot_Tickets,\n  sum(if(@message like \"select SUM(business_report.bet) as totBet, SUM(business_report.win) as totWin, SUM(business_report.bonus_bet) as bonus_\", 1, 0)) as Select_Sum_Business_Report,\n  sum(if(@message like \"select * from `users` where `id` =\", 1, 0)) as Select_User_by_ID,\n  sum(if(@message like \"select count(*) as aggregate from `games_temp` left join `games` on `games`.`external_id` = `games_temp`\", 1, 0)) as BM03,\n  sum(if(@message like \"select games_temp.*, games.id as exists_id, games.enabled as enabled, games.category_id as db_category_id, gamecategories.name as category_name\",1, 0)) as BM04,\n  sum(if(@message like \"select SUM(CASE WHEN transaction_type = 'deposit'THEN total else 0 END) as total_buy\",1, 0)) as BM06,\n  sum(if(@message like \"select count(users.id) AS total_count from `users` where `user_level` \", 1, 0)) as Count_Users_by_Level,\n  sum(if(@message like \"select count(*) as aggregate from `bonus_payments` inner join `bonuses` on `bonuses`.`id` = `bonus_payments`\", 1, 0)) as count_bonus_payments,\n  sum(if(@message like \"update `users` set `sport_token` = \", 1, 0)) as Update_Users_Sport_Token,\n  sum(if(@message like \"select count(*) as aggregate from `commission_cashback_payment` inner join `users`\", 1, 0)) as Count_Commission_Cashback_Payment,\n  sum(if(@message like \"select ordini.id, users.affiliate_id, ordini.payment_status, ordini.promocode, ordini.amount, ordini.skin_id\", 1, 0)) as Select_Orders_with_Affiliates,\n  sum(if(@message like \"update `users` set `last_login` =\", 1, 0)) as Update_Users_Last_Login,\n  sum(if(@message like \"select * from `logiq_feed_matches` where (CONCAT(home_name\", 1, 0)) as Select_Logiq_Feed_Matches,\n  sum(if(@message like \"select * from `users` where `users`.`parent_id` = \", 1, 0)) as Select_Users_by_Parent_ID,\n  sum(if(@message like \"select count(*) as aggregate from `commission_cashback_promotions`\", 1, 0)) as Count_Commission_Cashback_Promotions,\n  sum(if(@message like \"select SUM(business_report.bet) as totBet, SUM(business_report.win) as totWin, business_report.currency as currency,\", 1, 0)) as Select_Sum_Business_Report_with_Currency,\n  sum(if(@message like \"select CONCAT(SUBSTRING(users.mobile_prefix, 2), users.mobile) as msisdn\", 1, 0)) as Select_Concat_User_mobilePrefix,\n  sum(if(@message like \"select `sport_jackpots`.*, (select count(*) from `sport_jackpot_tickets`\", 1, 0)) as Select_Sport_Jeckpots,\n  sum(if(@message like \"select count(*) as aggregate from `sport_jackpot_tickets` left join `users` on `sport_jackpot_tickets`.`user_id`\", 1, 0)) as count_aggregate_sprot_jackpot_tickets,\n  sum(if(@message like \"insert into `ordini` (`amount`, `currency`, `userid`, `payment_method`, `skin_id`, `token`,\", 1, 0)) as InsertOrdini,\n  sum(if(@message like \"insert into `markets` (`active`, `category_name`\", 1, 0)) as Insert_into_Markets,\n  sum(if(@message like \"on duplicate key update `odd` = values(`odd`)\", 1, 0)) as Update_on_Duplicate_Key,\n  sum(if(@message like 'DBeaver', 1, 0)) as DBeaver_Queries\n    by bin(1d) as day\n| sort day asc",
            "lastModified": 1733396335226,
            "logGroupNames": [
                "/aws/rds/cluster/backoffice-pro-cluster/slowquery",
                "/aws/rds/cluster/casino-backoffice-bbdd/slowquery",
                "/aws/rds/cluster/playlogiq-cluster/slowquery"
            ]
        },
        {
            "queryDefinitionId": "71c11d95-4f02-4d23-ac9f-b30d13160149",
            "name": "casino/Process casino transaction on betmaker handled error count per 10m",
            "queryString": "filter @message like /local.ERROR/ and @message like \"OP_30\" \n| stats count(*) as errorsCount by bin(10m) as mins\n| sort mins desc",
            "lastModified": 1733136995919,
            "logGroupNames": [
                "casino"
            ]
        },
        {
            "queryDefinitionId": "5f87de01-87be-42b6-bf27-79c7c473f968",
            "name": "casino/Errors count per hour",
            "queryString": "filter @message like /local.ERROR/ and @message like \"OP_30\" \n| stats count(*) as errorsCount by bin(10m) as mins\n| sort mins desc",
            "lastModified": 1733136843996,
            "logGroupNames": [
                "casino"
            ]
        },
        {
            "queryDefinitionId": "4e0d0dda-2d03-4a81-995f-8dd27d640337",
            "name": "slow queries analisys/betmaker - count by type of query",
            "queryString": "fields @timestamp, @message\n| filter @logStream = 'playlogiq-instance'\n| stats\n  sum(if(@message like 'select `id`, `balance`, `balance_withdrawable`, `casino_balance`, `casino_balance_withdrawable`, `cash_block`, `parent_id`, `user_path`, `user_level`, `skin_id` from `users`', 1, 0)) as BM16,\n  sum(if(@message like 'update `users` set `balance` = balance-', 1, 0)) as BM14,\n  sum(if(@message like 'update `users` set `balance` = balance+', 1, 0)) as BM14_2,\n  sum(if(@message like \"select SUM(CASE WHEN type in ('add', 'add_bonus', 'add_bonus_cashback') THEN amount ELSE 0 END) as total_in, SUM(CASE WHEN type in ('out', 'out_bonus', 'out_bonus_cashback')\", 1, 0)) as Select_Sum_Case_When_Type,\n  sum(if(@message like \"update `the_sports_feeds` set `event_start` =\", 1, 0)) as Update_Sports_Feeds_Event_Start,\n  sum(if(@message like \"update `users` set `last_activity` = '\", 1, 0)) as Update_Users_Last_Activity,\n  sum(if(@message like \"select SUM(CASE WHEN provider_id NOT IN\", 1, 0)) as Select_Sum_Provider_ID_Not_In,\n  sum(if(@message like \"select * from `users` where `skin_id` = \", 1, 0)) as Select_Users_by_Skin_ID,\n  sum(if(@message like \"select bonus_payments.*, bonuses.name as bonus_name, skins.name as skin_name, users.username as user_name from `bonus_payments` inner join `bonuses`\", 1, 0)) as Select_Bonus_Payments,\n  sum(if(@message like \"select count(*) as aggregate from `sport_jackpot_tickets` where `sport_jackpot_tickets`.`sport_jackpots_id\", 1, 0)) as Count_Sport_Jackpot_Tickets,\n  sum(if(@message like \"select SUM(business_report.bet) as totBet, SUM(business_report.win) as totWin, SUM(business_report.bonus_bet) as bonus_\", 1, 0)) as Select_Sum_Business_Report,\n  sum(if(@message like \"select * from `users` where `id` =\", 1, 0)) as Select_User_by_ID,\n  sum(if(@message like \"select count(*) as aggregate from `games_temp` left join `games` on `games`.`external_id` = `games_temp`\", 1, 0)) as BM03,\n  sum(if(@message like \"select games_temp.*, games.id as exists_id, games.enabled as enabled, games.category_id as db_category_id, gamecategories.name as category_name\",1, 0)) as BM04,\n  sum(if(@message like \"select SUM(CASE WHEN transaction_type = 'deposit'THEN total else 0 END) as total_buy\",1, 0)) as BM06,\n  sum(if(@message like \"select count(users.id) AS total_count from `users` where `user_level` \", 1, 0)) as Count_Users_by_Level,\n  sum(if(@message like \"select count(*) as aggregate from `bonus_payments` inner join `bonuses` on `bonuses`.`id` = `bonus_payments`\", 1, 0)) as count_bonus_payments,\n  sum(if(@message like \"update `users` set `sport_token` = \", 1, 0)) as Update_Users_Sport_Token,\n  sum(if(@message like \"select count(*) as aggregate from `commission_cashback_payment` inner join `users`\", 1, 0)) as Count_Commission_Cashback_Payment,\n  sum(if(@message like \"select ordini.id, users.affiliate_id, ordini.payment_status, ordini.promocode, ordini.amount, ordini.skin_id\", 1, 0)) as Select_Orders_with_Affiliates,\n  sum(if(@message like \"update `users` set `last_login` =\", 1, 0)) as Update_Users_Last_Login,\n  sum(if(@message like \"select * from `logiq_feed_matches` where (CONCAT(home_name\", 1, 0)) as Select_Logiq_Feed_Matches,\n  sum(if(@message like \"select * from `users` where `users`.`parent_id` = \", 1, 0)) as Select_Users_by_Parent_ID,\n  sum(if(@message like \"select count(*) as aggregate from `commission_cashback_promotions`\", 1, 0)) as Count_Commission_Cashback_Promotions,\n  sum(if(@message like \"select SUM(business_report.bet) as totBet, SUM(business_report.win) as totWin, business_report.currency as currency,\", 1, 0)) as Select_Sum_Business_Report_with_Currency,\n  sum(if(@message like \"select CONCAT(SUBSTRING(users.mobile_prefix, 2), users.mobile) as msisdn\", 1, 0)) as Select_Concat_User_mobilePrefix,\n  sum(if(@message like \"select `sport_jackpots`.*, (select count(*) from `sport_jackpot_tickets`\", 1, 0)) as Select_Sport_Jeckpots,\n  sum(if(@message like \"select count(*) as aggregate from `sport_jackpot_tickets` left join `users` on `sport_jackpot_tickets`.`user_id`\", 1, 0)) as count_aggregate_sprot_jackpot_tickets,\n  sum(if(@message like \"insert into `ordini` (`amount`, `currency`, `userid`, `payment_method`, `skin_id`, `token`,\", 1, 0)) as InsertOrdini,\n  sum(if(@message like \"insert into `markets` (`active`, `category_name`\", 1, 0)) as Insert_into_Markets,\n  sum(if(@message like \"on duplicate key update `odd` = values(`odd`)\", 1, 0)) as Update_on_Duplicate_Key,\n  sum(if(@message like 'DBeaver', 1, 0)) as DBeaver_Queries",
            "lastModified": 1732895138476,
            "logGroupNames": [
                "/aws/rds/cluster/backoffice-pro-cluster/slowquery",
                "/aws/rds/cluster/casino-backoffice-bbdd/slowquery",
                "/aws/rds/cluster/playlogiq-cluster/slowquery"
            ]
        },
        {
            "queryDefinitionId": "34f02206-7a68-46dc-b734-2f2744b6d00d",
            "name": "casino stats/extract casino times",
            "queryString": "fields @timestamp, @message, @logStream, @log\n| parse @message '\"exec_time\":*,' as exec_timejson\n| parse @message '[exec_time] => *\\n' as exec_timearr\n| parse @message '\"error_type\":*}' as error_type\n| parse @message '\"error_trace\":\"#0 *:' as affected_file\n| parse @message '[integration_id] => * ' as integration_idarr\n| parse @message '\"integration_id\":*,' as integration_idjson\n| parse @message 'integrations*?' as urlcalled\n| fields coalesce(exec_timejson, exec_timearr) as exec_time\n| fields coalesce(integration_idjson, integration_idarr) as integration_id\n| filter @logStream like 'markor' \n| filter @message like 'response to' \n#filter below shows all errors handled and not handled\n| filter @message not like 'local.ERROR'\n#filter below shows only internal laravel errors - errors that are coming problems in php coding etc\n#| filter @message like 'error_trace'\n| display @timestamp, @message, @logStream, @log, exec_time, error_type, affected_file, integration_id, urlcalled\n|filter exec_time > 1\n| sort exec_time desc\n| limit 1000",
            "lastModified": 1733223525794,
            "logGroupNames": [
                "casino"
            ]
        },
        {
            "queryDefinitionId": "1b18e307-8ad0-45a4-ade0-b3e074d1b588",
            "name": "slow queries analisys/count slow and timings averages",
            "queryString": "fields @timestamp, @message, @logStream, @log\n| parse @message \"# Query_time: * \" as timing\n| parse @message \" Lock_time: * \" as locktiming\n#| filter @logStream = 'playlogiq-instance'\n| filter @message not like 'DBeaver' \n#and @message not like 'select * from payments ignore index'\n#and @message not like \"select * from `payments` where `type` = 'payout' and `transaction_id`\"\n#and @message not like \"update `casino_settings` set `value` = 1, `casino_settings`.`updated_at` =\"\n#and @message not like \"select sum(`amount`) as aggregate from `payments` where (`brand_id\"\n#and @message not like \"select `currency_code`, `type`, sum(amount) as total_amount from `payments` where `created_at` between\"\n#and @message not like \"select SUM(CASE WHEN type in ('add', 'add_bonus', 'add_bonus_cashback') THEN amount ELSE 0 END) as total_in, SUM(CASE WHEN type in\"\n#and @message not like \"update `casino_sessions` set `provider_token` =\"\n#and @message not like \"insert into `casino_sessions` (`userid`, `entity_id`, `casino_token`, `session_id`, `game_id`, `game_external_id`, `integration_id`, #`start_balance`, `status`, `client_ip`, `updateTime`, `addedTime`) values\"\n#and @message not like \"update `casino_sessions` set `status` = \"\n#and @message not like \"update `casino_sessions` set `casino_sessions`.`updateTime`\"\n#and @message not like \"select * from `casino_sessions` where `userid` = \"\n#and @message not like \"SELECT players.*, u_parent.username as parent_username, proxies.ip as proxy_ip,  proxies.port as proxy_port, proxies.is_active as proxy_active\"\n#and @message not like \"update `users` set `balance` = balance\"\n#and @message not like \"select count(*) as aggregate from `bonus_payments` inner join `bonuses` on `bonuses`.`id` = `bonus_payments`.`bonus_id` inner join `users` on #`users`.`id` = `bonus_paymen\"\n#and @message not like \"select count(users.id) AS total_count from `users` where `user_level` = \"\n#and @message not like \"select SUM(CASE WHEN provider_id NOT IN \"\n#and @message not like \"select `id`, `balance`, `balance_withdrawable`, `casino_balance`, `casino_balance_withdrawable` from `users` where `skin_id` =\"\n#and @message not like \"select business_report.provider_id as id,\"\n#and @message not like \"select users.*,  u_parent.username as parent_username, skins.name as skin_name, (select COALESCE\"\n#and @message not like \"select SUM(amount) as total from `ordini` where `userid` = \"\n#and @message not like \"select count(*) as aggregate from `sport_jackpot_tickets`\"\n#and @message not like \"select business_report.currency as currency, SUM(bonus_bet_closed) as bonus_bet_closed,\"\n#and @message not like \"select * from `users` where `users`.`parent_id` =\"\n#and @message not like \"select COALESCE(SUM(deposited), 0) as total_deposited, COALESCE(SUM(withdrawn), 0) as total_withdrawn from `transactions_reports` inner join `users` #on `users`.`id` = `transactions_reports`.`user_id` where `from` between\"\n#and timing > 0\n#and @message not like \"select `id`, `balance`, `balance_withdrawable`, `casino_balance`, `casino_balance_withdrawable`, `cash_block`, `parent_id`, `user_path`, #`user_level`, `skin_id` from `users` where `id` \"\n#and @message not like \"select * from `transactions_reports` where (`user_id` =\"\n#and @message not like \"select transactions.id,\n#        transactions.payeer_id,\n#        transactions.description,\"\n#and @message not like \"select business_report_hour.currency as currency,\n#            sum(bet) as bet,\n#            sum(bet_closed) as bet_closed,\n#            sum(bonus_bet_closed) as bonus_bet_closed,\n#            sum(win) as win,\"\n#and @message not like \"select `payments`.`id`, COALESCE(brands.name\"\n#and @message not like \"select count(*) as aggregate from `payments` where (`user_origin_id` = \"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n| stat\navg(locktiming) as locktimeAverage,\navg(timing) as timeAverage,\ncount(*) as slowq_count  \nby bin (5m) as interval\n| sort locktimeAverage desc",
            "lastModified": 1734077207946,
            "logGroupNames": [
                "/aws/rds/cluster/backoffice-pro-cluster/slowquery",
                "/aws/rds/cluster/casino-backoffice-bbdd/slowquery",
                "/aws/rds/cluster/playlogiq-cluster/slowquery"
            ]
        },
        {
            "queryDefinitionId": "11e03911-5514-4226-a855-6082aaf1102d",
            "name": "slow queries analisys/count by excel ref",
            "queryString": "fields @timestamp, @message\n| filter @logStream = 'playlogiq-instance'\n| stats\n  sum(if(@message like 'select `id`, `balance`, `balance_withdrawable`, `casino_balance`, `casino_balance_withdrawable`, `cash_block`, `parent_id`, `user_path`, `user_level`, `skin_id` from `users`', 1, 0)) as BM16,\n  sum(if(@message like 'update `users` set `balance` = balance-', 1, 0)) as BM14,\n  sum(if(@message like 'update `users` set `balance` = balance+', 1, 0)) as BM14_2,\n  sum(if(@message like \"select SUM(CASE WHEN type in ('add', 'add_bonus', 'add_bonus_cashback') THEN amount ELSE 0 END) as total_in, SUM(CASE WHEN type in ('out', 'out_bonus', 'out_bonus_cashback')\", 1, 0)) as Select_Sum_Case_When_Type,\n  sum(if(@message like \"update `the_sports_feeds` set `event_start` =\", 1, 0)) as Update_Sports_Feeds_Event_Start,\n  sum(if(@message like \"update `users` set `last_activity` = '\", 1, 0)) as Update_Users_Last_Activity,\n  sum(if(@message like \"select SUM(CASE WHEN provider_id NOT IN\", 1, 0)) as Select_Sum_Provider_ID_Not_In,\n  sum(if(@message like \"select * from `users` where `skin_id` = \", 1, 0)) as Select_Users_by_Skin_ID,\n  sum(if(@message like \"select bonus_payments.*, bonuses.name as bonus_name, skins.name as skin_name, users.username as user_name from `bonus_payments` inner join `bonuses`\", 1, 0)) as Select_Bonus_Payments,\n  sum(if(@message like \"select count(*) as aggregate from `sport_jackpot_tickets` where `sport_jackpot_tickets`.`sport_jackpots_id\", 1, 0)) as Count_Sport_Jackpot_Tickets,\n  sum(if(@message like \"select SUM(business_report.bet) as totBet, SUM(business_report.win) as totWin, SUM(business_report.bonus_bet) as bonus_\", 1, 0)) as Select_Sum_Business_Report,\n  sum(if(@message like \"select * from `users` where `id` =\", 1, 0)) as Select_User_by_ID,\n  sum(if(@message like \"select count(*) as aggregate from `games_temp` left join `games` on `games`.`external_id` = `games_temp`\", 1, 0)) as BM03,\n  sum(if(@message like \"select games_temp.*, games.id as exists_id, games.enabled as enabled, games.category_id as db_category_id, gamecategories.name as category_name\",1, 0)) as BM04,\n  sum(if(@message like \"select SUM(CASE WHEN transaction_type = 'deposit'THEN total else 0 END) as total_buy\",1, 0)) as BM06,\n  sum(if(@message like \"select count(users.id) AS total_count from `users` where `user_level` \", 1, 0)) as Count_Users_by_Level,\n  sum(if(@message like \"select count(*) as aggregate from `bonus_payments` inner join `bonuses` on `bonuses`.`id` = `bonus_payments`\", 1, 0)) as count_bonus_payments,\n  sum(if(@message like \"update `users` set `sport_token` = \", 1, 0)) as Update_Users_Sport_Token,\n  sum(if(@message like \"select count(*) as aggregate from `commission_cashback_payment` inner join `users`\", 1, 0)) as Count_Commission_Cashback_Payment,\n  sum(if(@message like \"select ordini.id, users.affiliate_id, ordini.payment_status, ordini.promocode, ordini.amount, ordini.skin_id\", 1, 0)) as Select_Orders_with_Affiliates,\n  sum(if(@message like \"update `users` set `last_login` =\", 1, 0)) as Update_Users_Last_Login,\n  sum(if(@message like \"select * from `logiq_feed_matches` where (CONCAT(home_name\", 1, 0)) as Select_Logiq_Feed_Matches,\n  sum(if(@message like \"select * from `users` where `users`.`parent_id` = \", 1, 0)) as Select_Users_by_Parent_ID,\n  sum(if(@message like \"select count(*) as aggregate from `commission_cashback_promotions`\", 1, 0)) as Count_Commission_Cashback_Promotions,\n  sum(if(@message like \"select SUM(business_report.bet) as totBet, SUM(business_report.win) as totWin, business_report.currency as currency,\", 1, 0)) as Select_Sum_Business_Report_with_Currency,\n  sum(if(@message like \"select CONCAT(SUBSTRING(users.mobile_prefix, 2), users.mobile) as msisdn\", 1, 0)) as Select_Concat_User_mobilePrefix,\n  sum(if(@message like \"select `sport_jackpots`.*, (select count(*) from `sport_jackpot_tickets`\", 1, 0)) as Select_Sport_Jeckpots,\n  sum(if(@message like \"select count(*) as aggregate from `sport_jackpot_tickets` left join `users` on `sport_jackpot_tickets`.`user_id`\", 1, 0)) as count_aggregate_sprot_jackpot_tickets,\n  sum(if(@message like \"insert into `ordini` (`amount`, `currency`, `userid`, `payment_method`, `skin_id`, `token`,\", 1, 0)) as InsertOrdini,\n  sum(if(@message like \"insert into `markets` (`active`, `category_name`\", 1, 0)) as Insert_into_Markets,\n  sum(if(@message like \"on duplicate key update `odd` = values(`odd`)\", 1, 0)) as Update_on_Duplicate_Key,\n  sum(if(@message like 'DBeaver', 1, 0)) as DBeaver_Queries\n    by bin(1d) as day\n| sort day asc",
            "lastModified": 1733396304631,
            "logGroupNames": [
                "/aws/rds/cluster/backoffice-pro-cluster/slowquery",
                "/aws/rds/cluster/casino-backoffice-bbdd/slowquery",
                "/aws/rds/cluster/playlogiq-cluster/slowquery"
            ]
        },
        {
            "queryDefinitionId": "0e23f621-130b-475d-ab9c-53a7bb8591ac",
            "name": "betmaker/Activated Commission Cashback Promo Bonuses daily",
            "queryString": "filter @message like /CommissionCashback Pay activate/\n| filter @message like /\"res\":1/\n| stats count(*) as activatedCCBonuses by bin(1d) as day\n| sort day desc\n",
            "lastModified": 1732184039016,
            "logGroupNames": [
                "betmaker"
            ]
        },
        {
            "queryDefinitionId": "05821df3-7ae3-4973-832f-ff66f2ad2f3f",
            "name": "backoffice/Backoffice Errors count per hour",
            "queryString": "filter @logStream = \"laravel-log\" \n| filter @message like /production.ERROR/\n#| stats count(*) as errorsCount by bin(1h) as hour\n#| sort hour desc",
            "lastModified": 1738446581926,
            "logGroupNames": [
                "backoffice"
            ]
        },
        {
            "queryDefinitionId": "04aa889e-e902-40c7-97ac-42f98b0c8415",
            "name": "slow queries analisys/betmaker - select all known (the ones we are already working on) queries numbers",
            "queryString": "fields @timestamp, @message, @logStream, @log\n| parse @message \"# Query_time: * \" as timing\n| parse @message \" Lock_time: * \" as locktiming\n#| filter @logStream = 'playlogiq-instance'\n| filter @message not like 'DBeaver' \nand @message not like 'select * from payments ignore index'\nand @message not like \"select * from `payments` where `type` = 'payout' and `transaction_id`\"\nand @message not like \"update `casino_settings` set `value` = 1, `casino_settings`.`updated_at` =\"\nand @message not like \"select sum(`amount`) as aggregate from `payments` where (`brand_id\"\nand @message not like \"select `currency_code`, `type`, sum(amount) as total_amount from `payments` where `created_at` between\"\nand @message not like \"select SUM(CASE WHEN type in ('add', 'add_bonus', 'add_bonus_cashback') THEN amount ELSE 0 END) as total_in, SUM(CASE WHEN type in\"\nand @message not like \"update `casino_sessions` set `provider_token` =\"\nand @message not like \"insert into `casino_sessions` (`userid`, `entity_id`, `casino_token`, `session_id`, `game_id`, `game_external_id`, `integration_id`, `start_balance`, `status`, `client_ip`, `updateTime`, `addedTime`) values\"\nand @message not like \"update `casino_sessions` set `status` = \"\nand @message not like \"update `casino_sessions` set `casino_sessions`.`updateTime`\"\nand @message not like \"select * from `casino_sessions` where `userid` = \"\nand @message not like \"SELECT players.*, u_parent.username as parent_username, proxies.ip as proxy_ip,  proxies.port as proxy_port, proxies.is_active as proxy_active\"\nand @message not like \"update `users` set `balance` = balance\"\nand @message not like \"select count(*) as aggregate from `bonus_payments` inner join `bonuses` on `bonuses`.`id` = `bonus_payments`.`bonus_id` inner join `users` on `users`.`id` = `bonus_paymen\"\nand @message not like \"select count(users.id) AS total_count from `users` where `user_level` = \"\nand @message not like \"select SUM(CASE WHEN provider_id NOT IN \"\nand @message not like \"select `id`, `balance`, `balance_withdrawable`, `casino_balance`, `casino_balance_withdrawable` from `users` where `skin_id` =\"\nand @message not like \"select business_report.provider_id as id,\"\nand @message not like \"select users.*,  u_parent.username as parent_username, skins.name as skin_name, (select COALESCE\"\nand @message not like \"select SUM(amount) as total from `ordini` where `userid` = \"\nand @message not like \"select count(*) as aggregate from `sport_jackpot_tickets`\"\nand @message not like \"select business_report.currency as currency, SUM(bonus_bet_closed) as bonus_bet_closed,\"\nand @message not like \"select * from `users` where `users`.`parent_id` =\"\nand @message not like \"select COALESCE(SUM(deposited), 0) as total_deposited, COALESCE(SUM(withdrawn), 0) as total_withdrawn from `transactions_reports` inner join `users` on `users`.`id` = `transactions_reports`.`user_id` where `from` between\"\nand timing > 0\nand @message not like \"select `id`, `balance`, `balance_withdrawable`, `casino_balance`, `casino_balance_withdrawable`, `cash_block`, `parent_id`, `user_path`, `user_level`, `skin_id` from `users` where `id` \"\nand @message not like \"select * from `transactions_reports` where (`user_id` =\"\nand @message not like \"select transactions.id,\n        transactions.payeer_id,\n        transactions.description,\"\nand @message not like \"select business_report_hour.currency as currency,\n            sum(bet) as bet,\n            sum(bet_closed) as bet_closed,\n            sum(bonus_bet_closed) as bonus_bet_closed,\n            sum(win) as win,\"\nand @message not like \"select `payments`.`id`, COALESCE(brands.name\"\nand @message not like \"select count(*) as aggregate from `payments` where (`user_origin_id` = \"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n#and @message  like \"\"\n| sort locktiming desc\n| limit 10000",
            "lastModified": 1733938012804,
            "logGroupNames": [
                "/aws/rds/cluster/backoffice-pro-cluster/slowquery",
                "/aws/rds/cluster/casino-backoffice-bbdd/slowquery",
                "/aws/rds/cluster/playlogiq-cluster/slowquery"
            ]
        }
    ]
}
